((function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=Array.prototype.slice;a=function(){function a(a,c){var d,e,f;this.url=a!=null?a:location.origin,this.options=c!=null?c:{},this.getSender=b(this.getSender,this),this.getListener=b(this.getListener,this),this.handleSession=b(this.handleSession,this),this.handleServices=b(this.handleServices,this),this.handleMessage=b(this.handleMessage,this),this.handleClose=b(this.handleClose,this),this.clearSession=b(this.clearSession,this),(d=this.options).prefix==null&&(d.prefix="vein"),(e=this.options).sessionName==null&&(e.sessionName="VEINSESSID-"+this.options.prefix),(f=this.options).sessionExpires==null&&(f.sessionExpires=1),this.socket=new SockJS(""+this.url+"/"+this.options.prefix,null,this.options),this.callbacks.services=this.handleServices,this.callbacks.session=this.handleSession,this.socket.onmessage=this.handleMessage,this.socket.onclose=this.handleClose,this.session=this.cookie();return}return a.prototype.callbacks={},a.prototype.subscribe={},a.prototype.session=void 0,a.prototype.clearSession=function(){this.session=void 0,this.cookie("fizz",!0)},a.prototype.ready=function(a){return this.callbacks.ready=a},a.prototype.close=function(a){return this.callbacks.close=a},a.prototype.handleClose=function(){var a;return typeof (a=this.callbacks).close=="function"?a.close():void 0},a.prototype.handleMessage=function(a){var b,c,d,e,f,g,h,i,j,k;i=JSON.parse(a.data),d=i.id,f=i.service,b=i.args;if(this.subscribe[f]&&this.subscribe[f].listeners){j=this.subscribe[f].listeners;for(g=0,h=j.length;g<h;g++)c=j[g],c.apply(null,b)}if(!this.callbacks[d])return;e=(k=this.callbacks)[d].apply(k,b),e||delete this.callbacks[d]},a.prototype.handleServices=function(){var a,b,d,e,f,g,h;b=1>arguments.length?[]:c.call(arguments,0);for(e=0,g=b.length;e<g;e++)a=b[e],this[a]=this.getSender(a);for(f=0,h=b.length;f<h;f++)a=b[f],this.subscribe[a]=this.getListener(a);typeof (d=this.callbacks)["ready"]=="function"&&d.ready(b),delete this.callbacks.ready},a.prototype.handleSession=function(a){return this.session=a,this.cookie(a),!0},a.prototype.getListener=function(a){var b=this;return function(c){var d;(d=b.subscribe[a]).listeners==null&&(d.listeners=[]),b.subscribe[a].listeners.push(c)}},a.prototype.getSender=function(a){var b=this;return function(){var d,e,f,g;d=2>arguments.length?(g=0,[]):c.call(arguments,0,g=arguments.length-1),e=arguments[g++],f=b.getId(),b.callbacks[f]=e,b.socket.send(JSON.stringify({id:f,service:a,args:d}))}},a.prototype.cookie=function(a,b){var c,d,e,f,g,h,i;b==null&&(b=!1),f=this.options.sessionName,e=b?new Date("Thu, 01-Jan-1970 00:00:01 GMT"):this.options.sessionExpires;if(a)return e&&(typeof e=="number"?(d=new Date,d.setTime(d.getTime()+e*24*60*60*1e3)):e.toUTCString&&(d=e)),document.cookie=""+f+"="+encodeURIComponent(a)+";expires="+d.toUTCString();if(document.cookie&&document.cookie.length!==0){i=document.cookie.split(";");for(g=0,h=i.length;g<h;g++){c=i[g];if(c.substring(0,f.length+1)===""+f+"=")return decodeURIComponent(c.substring(f.length+1))}}},a.prototype.getId=function(){var a;return a=function(){return((1+Math.random())*268435456|0).toString(16)},a()+a()+a()},a}(),typeof define=="function"?define(function(){return a}):window.Vein=a})).call(this);