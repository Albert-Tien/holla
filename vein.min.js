((function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=Array.prototype.slice;a=function(){function a(a,c){a==null&&(a=location.origin),this.getSender=b(this.getSender,this),this.getListener=b(this.getListener,this),this.handleInitial=b(this.handleInitial,this),this.handleMessage=b(this.handleMessage,this),this.handleClose=b(this.handleClose,this),this.socket=new SockJS(""+a+"/vein",null,c),this.callbacks.services=this.handleInitial,this.socket.onmessage=this.handleMessage,this.socket.onclose=this.handleClose;return}return a.prototype.callbacks={},a.prototype.subscribe={},a.prototype.ready=function(a){return this.callbacks.ready=a},a.prototype.close=function(a){return this.callbacks.close=a},a.prototype.handleClose=function(){var a;return typeof (a=this.callbacks).close=="function"?a.close():void 0},a.prototype.handleMessage=function(a){var b,c,d,e,f,g,h,i,j;h=JSON.parse(a.data),d=h.id,e=h.service,b=h.args;if(this.subscribe[e]&&this.subscribe[e].listeners&&!d){i=this.subscribe[e].listeners;for(f=0,g=i.length;f<g;f++)c=i[f],c.apply(null,b)}else{if(!this.callbacks[d])return;(j=this.callbacks)[d].apply(j,b),delete this.callbacks[d]}},a.prototype.handleInitial=function(){var a,b,d,e,f,g,h;b=1>arguments.length?[]:c.call(arguments,0);for(e=0,g=b.length;e<g;e++)a=b[e],this[a]=this.getSender(a);for(f=0,h=b.length;f<h;f++)a=b[f],this.subscribe[a]=this.getListener(a);typeof (d=this.callbacks)["ready"]=="function"&&d.ready(b),delete this.callbacks.ready},a.prototype.getListener=function(a){var b=this;return function(c){var d;(d=b.subscribe[a]).listeners==null&&(d.listeners=[]),b.subscribe[a].listeners.push(c)}},a.prototype.getSender=function(a){var b=this;return function(){var d,e,f,g;d=2>arguments.length?(g=0,[]):c.call(arguments,0,g=arguments.length-1),e=arguments[g++],f=b.getId(),b.callbacks[f]=e,b.socket.send(JSON.stringify({id:f,service:a,args:d}))}},a.prototype.getId=function(){var a;return a=function(){return((1+Math.random())*268435456|0).toString(16)},a()+a()+a()},a}(),window.Vein=a})).call(this);