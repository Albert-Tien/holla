(function(){var a,b,c,d={}.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a},f=function(a,b){return function(){return a.apply(b,arguments)}},g=[].slice;c={getItem:function(a){if(!c.hasItem(a))return;return unescape(document.cookie.replace(RegExp("(?:^|.*;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1"))},setItem:function(a,b,c){var d;d="",typeof c=="number"&&(d="; max-age="+c),typeof c=="string"&&(d="; expires="+c);if(typeof c=="object"?c.toGMTString:void 0)d="; expires="+c.toGMTString();document.cookie=""+escape(a)+"="+escape(b)+d},removeItem:function(a){document.cookie=""+escape(a)+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/"},hasItem:function(a){var b;return b=RegExp("(?:^|;\\s*)"+(escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")),b.test(document.cookie)}},a=function(a){function b(a){this.message=a}return e(b,a),b.name="ServerError",b.prototype.name="ServerError",b}(Error),b=function(){function b(a){var b,c,d;this.options=a!=null?a:{},this.handleMethods=f(this.handleMethods,this),this.handleMessage=f(this.handleMessage,this),this.handleClose=f(this.handleClose,this),this.setSession=f(this.setSession,this),(b=this.options).prefix==null&&(b.prefix="vein"),(c=this.options).host==null&&(c.host=""+window.location.protocol+"//"+window.location.hostname),(d=this.options).sessionName==null&&(d.sessionName="VEINSESSID-"+this.options.prefix),this.socket=new SockJS(""+this.options.host+"/"+this.options.prefix,null,this.options),this.callbacks.methods=this.handleMethods,this.callbacks.session=this.setSession,this.socket.onmessage=this.handleMessage,this.socket.onclose=this.handleClose;return}return b.name="Vein",b.prototype.connected=null,b.prototype.callbacks={ready:[],close:[]},b.prototype.subscribe={},b.prototype.getSession=function(){return c.getItem(this.options.sessionName)},b.prototype.setSession=function(a){return console.log("[Vein] Setting session to "+a),c.setItem(this.options.sessionName,a,this.options.sessionLength),!0},b.prototype.clearSession=function(){c.removeItem(this.options.sessionName)},b.prototype.ready=function(a){this.callbacks.ready.push(a);if(this.connected===!0)return a(this.methods)},b.prototype.close=function(a){this.callbacks.close.push(a);if(this.connected===!1)return a(this.methods)},b.prototype.handleReady=function(a){var b,c,d,e,f;this.methods=a,this.connected=!0,e=this.callbacks.ready,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(b(a));return f},b.prototype.handleClose=function(){var a,b,c,d,e;this.connected=!1,d=this.callbacks.close,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a());return e},b.prototype.handleMessage=function(b){var c,d,e,f,g,h,i,j,k,l,m;k=JSON.parse(b.data),e=k.id,g=k.method,h=k.params,c=k.error,Array.isArray(h)||(h=[h]),console.log("[Vein] Incoming message: Id="+e+" Method="+g+" Arguments="+JSON.stringify(h)+" Error="+c);if(c!=null)throw new a(c);if(this.subscribe[g]&&this.subscribe[g].listeners){l=this.subscribe[g].listeners;for(i=0,j=l.length;i<j;i++)d=l[i],d.apply(null,h)}if(!this.callbacks[e])return;f=(m=this.callbacks)[e].apply(m,h),f!==!0&&delete this.callbacks[e]},b.prototype.handleMethods=function(){var a,b,c,d,e,f;b=1>arguments.length?[]:g.call(arguments,0);for(c=0,e=b.length;c<e;c++)a=b[c],this[a]=this.getSender(a);for(d=0,f=b.length;d<f;d++)a=b[d],this.subscribe[a]=this.getListener(a);this.handleReady(b)},b.prototype.getListener=function(a){var b=this;return function(c){var d;(d=b.subscribe[a]).listeners==null&&(d.listeners=[]),b.subscribe[a].listeners.push(c)}},b.prototype.getSender=function(a){var b=this;return function(){var c,d,e,f;e=2>arguments.length?(f=0,[]):g.call(arguments,0,f=arguments.length-1),c=arguments[f++],d=b.getId(),b.callbacks[d]=c,console.log("[Vein] Outgoing message: Id="+d+" Method="+a+" Arguments="+JSON.stringify(e)+" Session="+b.getSession()),b.socket.send(JSON.stringify({id:d,method:a,params:e,session:b.getSession()}))}},b.prototype.getId=function(){var a;return a=function(){return((1+Math.random())*268435456|0).toString(16)},a()+a()+a()},b}(),typeof define=="function"?define(function(){return b}):window.Vein=b}).call(this);