((function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d=Array.prototype.slice;b={getItem:function(a){if(!b.hasItem(a))return;return unescape(document.cookie.replace(RegExp("(?:^|.*;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1"))},setItem:function(a,b,c,d,e,f){var g;if(c){typeof c=="number"&&(g="; max-age="+c),typeof c=="string"&&(g="; expires="+c);if(typeof c=="object"?c.hasOwnProperty("toGMTString"):void 0)g="; expires="+c.toGMTString()}return e=e?"; domain="+e:"",d=d?"; path="+d:"",g=g?g:"",f=f?"; secure":"",document.cookie=""+escape(a)+"="+escape(b)+g+e+d+f},removeItem:function(a){var c;if(!b.hasItem(a))return;return c=new Date,c.setDate(c.getDate()-1),document.cookie=""+escape(a)+"=; expires="+c.toGMTString()+"; path=/"},hasItem:function(a){return RegExp("(?:^|;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}},a=function(){function a(a,b){var d,e;this.url=a!=null?a:location.origin,this.options=b!=null?b:{},this.getSender=c(this.getSender,this),this.getListener=c(this.getListener,this),this.handleSession=c(this.handleSession,this),this.handleServices=c(this.handleServices,this),this.handleMessage=c(this.handleMessage,this),this.handleClose=c(this.handleClose,this),this.clearSession=c(this.clearSession,this),(d=this.options).prefix==null&&(d.prefix="vein"),(e=this.options).sessionName==null&&(e.sessionName="VEINSESSID-"+this.options.prefix),this.socket=new SockJS(""+this.url+"/"+this.options.prefix,null,this.options),this.callbacks.services=this.handleServices,this.callbacks.session=this.handleSession,this.socket.onmessage=this.handleMessage,this.socket.onclose=this.handleClose,this.session=this.cookie();return}return a.prototype.callbacks={},a.prototype.subscribe={},a.prototype.session=void 0,a.prototype.clearSession=function(){this.session=void 0,this.cookie("",!0)},a.prototype.ready=function(a){return this.callbacks.ready=a},a.prototype.close=function(a){return this.callbacks.close=a},a.prototype.handleClose=function(){var a;return typeof (a=this.callbacks).close=="function"?a.close():void 0},a.prototype.handleMessage=function(a){var b,c,d,e,f,g,h,i,j,k;i=JSON.parse(a.data),d=i.id,f=i.service,b=i.args;if(this.subscribe[f]&&this.subscribe[f].listeners){j=this.subscribe[f].listeners;for(g=0,h=j.length;g<h;g++)c=j[g],c.apply(null,b)}if(!this.callbacks[d])return;e=(k=this.callbacks)[d].apply(k,b),e||delete this.callbacks[d]},a.prototype.handleServices=function(){var a,b,c,e,f,g,h;b=1>arguments.length?[]:d.call(arguments,0);for(e=0,g=b.length;e<g;e++)a=b[e],this[a]=this.getSender(a);for(f=0,h=b.length;f<h;f++)a=b[f],this.subscribe[a]=this.getListener(a);typeof (c=this.callbacks)["ready"]=="function"&&c.ready(b),delete this.callbacks.ready},a.prototype.handleSession=function(a){return this.session=a,this.cookie(a),!0},a.prototype.getListener=function(a){var b=this;return function(c){var d;(d=b.subscribe[a]).listeners==null&&(d.listeners=[]),b.subscribe[a].listeners.push(c)}},a.prototype.getSender=function(a){var b=this;return function(){var c,e,f,g;c=2>arguments.length?(g=0,[]):d.call(arguments,0,g=arguments.length-1),e=arguments[g++],f=b.getId(),b.callbacks[f]=e,b.socket.send(JSON.stringify({id:f,service:a,args:c}))}},a.prototype.cookie=function(a,c){var d;return d=this.options.sessionName,c?b.removeItem(d):a?b.setItem(d,a,this.options.sessionExpires):b.getItem(d)},a.prototype.getId=function(){var a;return a=function(){return((1+Math.random())*268435456|0).toString(16)},a()+a()+a()},a}(),typeof define=="function"?define(function(){return a}):window.Vein=a})).call(this);