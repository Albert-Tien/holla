(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d=Array.prototype.slice;b={getItem:function(a){if(!b.hasItem(a))return;return unescape(document.cookie.replace(RegExp("(?:^|.*;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1"))},setItem:function(a,b,c){var d;d="",typeof c=="number"&&(d="; max-age="+c),typeof c=="string"&&(d="; expires="+c);if(typeof c=="object"?c.toGMTString:void 0)d="; expires="+c.toGMTString();document.cookie=""+escape(a)+"="+escape(b)+d},removeItem:function(a){document.cookie=""+escape(a)+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/"},hasItem:function(a){var b;return b=RegExp("(?:^|;\\s*)"+(escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")),b.test(document.cookie)}},a=function(){function a(a){var b,d,e;this.options=a!=null?a:{},this.getSender=c(this.getSender,this),this.getListener=c(this.getListener,this),this.handleMethods=c(this.handleMethods,this),this.handleMessage=c(this.handleMessage,this),this.handleClose=c(this.handleClose,this),this.clearSession=c(this.clearSession,this),this.setSession=c(this.setSession,this),this.getSession=c(this.getSession,this),(b=this.options).prefix==null&&(b.prefix="vein"),(d=this.options).host==null&&(d.host=location.origin),(e=this.options).sessionName==null&&(e.sessionName="VEINSESSID-"+this.options.prefix),this.socket=new SockJS(""+this.options.host+"/"+this.options.prefix,null,this.options),this.callbacks.methods=this.handleMethods,this.callbacks.session=this.setSession,this.socket.onmessage=this.handleMessage,this.socket.onclose=this.handleClose;return}return a.prototype.callbacks={},a.prototype.subscribe={},a.prototype.getSession=function(){return b.getItem(this.options.sessionName)},a.prototype.setSession=function(a){return b.setItem(this.options.sessionName,a,this.options.sessionLength),!0},a.prototype.clearSession=function(){b.removeItem(this.options.sessionName)},a.prototype.ready=function(a){return this.callbacks.ready=a},a.prototype.close=function(a){return this.callbacks.close=a},a.prototype.handleClose=function(){var a;return typeof (a=this.callbacks).close=="function"?a.close():void 0},a.prototype.handleMessage=function(a){var b,c,d,e,f,g,h,i,j,k,l;j=JSON.parse(a.data),d=j.id,f=j.method,g=j.params,b=j.err,Array.isArray(g)||(g=[g]);if(this.subscribe[f]&&this.subscribe[f].listeners){k=this.subscribe[f].listeners;for(h=0,i=k.length;h<i;h++)c=k[h],c.apply(null,g)}if(!this.callbacks[d])return;e=(l=this.callbacks)[d].apply(l,g),e!==!0&&delete this.callbacks[d]},a.prototype.handleMethods=function(){var a,b,c,e,f,g,h;b=1>arguments.length?[]:d.call(arguments,0);for(e=0,g=b.length;e<g;e++)a=b[e],this[a]=this.getSender(a);for(f=0,h=b.length;f<h;f++)a=b[f],this.subscribe[a]=this.getListener(a);typeof (c=this.callbacks)["ready"]=="function"&&c.ready(b),delete this.callbacks.ready},a.prototype.getListener=function(a){var b=this;return function(c){var d;(d=b.subscribe[a]).listeners==null&&(d.listeners=[]),b.subscribe[a].listeners.push(c)}},a.prototype.getSender=function(a){var b=this;return function(){var c,e,f,g;f=2>arguments.length?(g=0,[]):d.call(arguments,0,g=arguments.length-1),c=arguments[g++],e=b.getId(),b.callbacks[e]=c,b.socket.send(JSON.stringify({id:e,method:a,params:f,session:b.getSession()}))}},a.prototype.getId=function(){var a;return a=function(){return((1+Math.random())*268435456|0).toString(16)},a()+a()+a()},a}(),typeof define=="function"?define(function(){return a}):window.Vein=a}).call(this);